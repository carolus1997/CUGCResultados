<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen de Seguridad Marítima</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ajustes de estilo adicionales */
        .question {
            margin-bottom: 20px;
        }

        .disabled-checkbox {
            pointer-events: none;
            /* Deshabilitar eventos del mouse */
            opacity: 0.5;
            /* Opacidad para indicar que está deshabilitado */
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Examen de Seguridad Marítima</h1>
        <form id="examForm">
            <div class="question">
                <h5>1. ¿Cuál es el principal Centro de Mando y Control implicado en la incidencia?</h5>
                <div class="form-group">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question1" id="option1" value="SIVE">
                        <label class="form-check-label" for="option1">SIVE</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question1" id="option2" value="CRVME">
                        <label class="form-check-label" for="option2">Centro Regional de Vigilancia Marítima del
                            Estrecho (CRVME)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question1" id="option3" value="CCON">
                        <label class="form-check-label" for="option3">Centro de Concentración contra el Narcotráfico
                            (CCON)</label>
                    </div>
                </div>
            </div>
            <div class="question">
                <h5>2. Elija 3 opciones: ¿De dónde obtendría información?</h5>
                <div class="form-group" id="options2">
                    <!-- Opciones generadas dinámicamente en JavaScript -->
                </div>
            </div>
            <div class="question">
                <h5>3. Elija 3 opciones: Decisiones a adoptar con la información conocida</h5>
                <div class="form-group" id="options3">
                    <!-- Opciones generadas dinámicamente en JavaScript -->
                </div>
            </div>
            <div class="question">
                <h5>4. Elija 3 opciones: Mensajes principales a la ciudadanía</h5>
                <div class="form-group" id="options4">
                    <!-- Opciones generadas dinámicamente en JavaScript -->
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Enviar respuestas</button>
        </form>
    </div>

    <!-- Bootstrap JS y jQuery (opcional) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const examForm = document.getElementById("examForm");
            const modal = document.getElementById("confirmationModal");

            // Función para generar las opciones de las preguntas
            function generateOptions(questionIndex, optionsList) {
                const questionDiv = document.getElementById(`options${questionIndex + 2}`);
                optionsList.forEach(option => {
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.className = "form-check-input";
                    checkbox.name = `question${questionIndex + 2}`;
                    checkbox.value = option;
                    const label = document.createElement("label");
                    label.className = "form-check-label";
                    label.textContent = option;
                    const div = document.createElement("div");
                    div.className = "form-check";
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    questionDiv.appendChild(div);

                    // Agregar evento de escucha para deshabilitar checkboxes extras
                    checkbox.addEventListener("change", function () {
                        const checkedCheckboxes = questionDiv.querySelectorAll('input[type="checkbox"]:checked');
                        if (checkedCheckboxes.length >= 3) {
                            // Deshabilitar checkboxes extras
                            const allCheckboxes = questionDiv.querySelectorAll('input[type="checkbox"]');
                            allCheckboxes.forEach(cb => {
                                if (!cb.checked) {
                                    cb.disabled = true;
                                    cb.parentNode.classList.add("disabled-checkbox");
                                }
                            });
                        } else {
                            // Habilitar todos los checkboxes
                            const allCheckboxes = questionDiv.querySelectorAll('input[type="checkbox"]');
                            allCheckboxes.forEach(cb => {
                                cb.disabled = false;
                                cb.parentNode.classList.remove("disabled-checkbox");
                            });
                        }
                    });
                });
            }

            // Generar las opciones para las preguntas 2, 3 y 4
            generateOptions(0, ["Patrullas y aeronaves GC enviadas a las playas", "Drones de Ejército del Áire y del Espacio", "Redes sociales y medios de comunicación", "Sistemas de vigilancia de la Armada", "Prensa escrita", "Sistema de información del Puerto de Algeciras", "Fiscalía", "Información obtenida de controles GAR", "Hospitales de la zona"]);
            generateOptions(1, ["Despliegue de un Buque BAN de la Armada", "Despliegue de unidades de investigación GC y solicitud colaboración PN y PL", "Cierre de la Frontera Hispano-Marroquí", "Despliegue del Ejército de Tierra en España", "Controles de carreteras y despliegue de unidades GAR", "Solicitud de despliegue y controles de unidades de policía local", "Intercambio de información con oficiales de enlace y CCP Tánger y Algeciras", "Solicitud de apertura de diligencias penales en Audiencia Nacional", "Toma de control de la sala de operaciones GC en Madrid"]);
            generateOptions(2, ["Portavoz GC informa sobre incidente y detalle de personas detenidas", "Portavoz GC informa de respuesta del Estado ante incidente de seguridad", "No se realiza comunicación institucional", "Portavoz GC solicita colaboración ciudadana para detener narcotraficantes", "Asociaciones y sindicatos policiales llaman a la calma e informan de actuaciones", "Portavoz GC informa sobre situación en las playas y mensaje de calma", "Alcalde de Barbate informa sobre actuaciones policiales", "Alcalde de Tarifa informa sobre actuaciones policiales", "Juez de Instrucción informa sobre actuaciones judiciales"]);

            // Función para mostrar el modal de confirmación
            function showModal() {
                $('#confirmationModal').modal('show');

                var countdown = 5; // Tiempo en segundos para la cuenta atrás
                var countdownElement = document.getElementById('countdown');

                var timer = setInterval(function () {
                    countdownElement.textContent = countdown;
                    countdown--;

                    if (countdown < 0) {
                        clearInterval(timer);
                        // Cerrar la página después de la cuenta atrás
                        window.close();
                    }
                }, 1000);
            }


            // Función para validar las respuestas al enviar el formulario
            examForm.addEventListener("submit", function (event) {
                event.preventDefault(); // Evita que se envíe el formulario

                // Mostrar el modal de confirmación
                showModal();
            });
        });

        // Función para enviar las respuestas al archivo script.js
        function sendAnswersToScriptJS() {
            // Obtener las respuestas seleccionadas
            const selectedAnswersJSON = JSON.stringify(selectedAnswersByCategory);

            // Crear una solicitud XMLHttpRequest
            const xhr = new XMLHttpRequest();
            const url = "scriptchart.js";

            // Configurar la solicitud
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");

            // Manejar la respuesta de la solicitud
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log("Respuestas enviadas correctamente a script.js");
                }
            };

            // Enviar la solicitud con las respuestas como datos JSON
            xhr.send(selectedAnswersJSON);
        }

        // Llamar a la función para enviar las respuestas cuando se active el evento "DOMContentLoaded"
        document.addEventListener('DOMContentLoaded', function () {
            sendAnswersToScriptJS();
        });
    </script>

    <!-- Modal de confirmación -->
    <div id="confirmationModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmación</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Las respuestas se han enviado correctamente.</p>
                    <p>Esta ventana se cerrará automáticamente en <span id="countdown">5</span> segundos.</p>
                </div>
            </div>
        </div>
    </div>
    

</body>

</html>